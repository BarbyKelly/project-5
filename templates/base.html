<!-- Base for base.html from Boutique Ado, like most of this project. -->
<!-- Meta, JS and toast fixed with ChatGPT's guidance -->
{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    {% block meta %}
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="google-site-verification" content="2GllS38cQ4AvENLO6njtCQI0HR2M-_2-azChKY6Djns">

      <!-- Basic SEO - created with ChatGPT's guidance -->
      <meta name="description" content="Kelly's Art & Photo Boutique - children's original handmade art and variety of photos, ideal as gifts or décor">
      <meta name="keywords" content="art, photos, boutique, handmade, original, Kelly's Art & Photo Boutique, gifts, décor">
      <meta name="author" content="Kelly's Art & Photo Boutique, Aoife Kelly, Barby Kelly, Ciara Kelly">

      <!-- Open Graph, Facebook, and WhatsApp - learned from ChatGPT -->
      <meta property="og:title" content="Kelly's Art & Photo Boutique">
      <meta property="og:description" content="Children's original handmade art and variety of photos, ideal as gifts or décor">
      <meta property="og:type" content="website">
      <meta property="og:url" content="https://kellys-art-and-photo-boutique-913058c0223e.herokuapp.com/">
      <meta property="og:image" content="{% static 'images/social-preview.jpg' %}">

      <!-- Twitter Card  -->
      <meta name="twitter:card" content="summary_large_image">
      <meta name="twitter:title" content="Kelly's Art & Photo Boutique">
      <meta name="twitter:description" content="Children's original handmade art and variety of photos, ideal as gifts or décor">
      <meta name="twitter:image" content="{% static 'images/social-preview.jpg' %}">

      <!-- Favicon links - fixed with chatGPT's guidance-->
      <link rel="icon" type="image/png" sizes="192x192" href="{% static 'favicon/favicon-192x192.png' %}">
      <link rel="icon" type="image/png" sizes="512x512" href="{% static 'favicon/favicon-512x512.png' %}">
      <link rel="apple-touch-icon" sizes="180x180" href="{% static 'favicon/apple-touch-icon.png' %}">
      <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon/favicon-32x32.png' %}">
      <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon/favicon-16x16.png' %}">
      <link rel="shortcut icon" type="image/x-icon" href="{% static 'favicon/favicon.ico' %}">

      <!-- PWA webmanifest - added with ChatGPT's guidance -->
      <link rel="manifest" href="{% static 'favicon/site.webmanifest' %}">
      <meta name="theme-color" content="#FFFFFF">
    {% endblock %}

    {% block extra_meta %}
    {% endblock %}

    <!-- Lightbox2 CSS - copied from ChatGPT to fix image click after csp was added -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/css/lightbox.min.css" rel="stylesheet">

    {% block corecss %}
      <!-- Bootstrap 4.6.2 CSS -->
      <link rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N"
            crossorigin="anonymous">

      <!-- Google Fonts Preconnect -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

      <!-- Google Fonts - Main site font - copied from chatGPT, to improve loading time -->
      <link rel="preload"
            href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
      <noscript>
        <link rel="stylesheet"
              href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap">
      </noscript>

      <!-- Custom CSS -->
      <link rel="stylesheet" href="{% static 'css/base.css' %}">
    {% endblock %}

    {% block extra_css %}
    {% endblock %}

    {% block corejs %}
      <!-- Font Awesome -->
      <script src="https://kit.fontawesome.com/5d412561c7.js"
              crossorigin="anonymous"></script>

      <!-- jQuery -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
              integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
              crossorigin="anonymous"
              referrerpolicy="no-referrer"></script>

      <!-- Popper.js -->
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
              integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
              crossorigin="anonymous"></script>

      <!-- Bootstrap 4.6.2 JS -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
              integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
              crossorigin="anonymous"></script>

      <!-- Stripe -->
      <script src="https://js.stripe.com/v3/"></script>
    {% endblock %}

    {% block extra_js %}
    {% endblock %}

    <title>Kelly's Art & Photo Boutique {% block extra_title %}{% endblock %}</title>
  </head>

  <body class="d-flex flex-column h-100 main-bg">
    <!-- Header - fixed with chatGPT's help, to remove topnav, place Logo left and burger menu right for all screens -->
    <header class="container-fluid fixed-top header-container">
      <nav class="navbar navbar-expand-xl navbar-light bg-white w-100 justify-content-between py-2 shadow-sm position-relative">

        <!-- Logo - left on all screens -->
        <a href="{% url 'products_home' %}" class="nav-link main-logo-link">
          <img class="boutique-logo" src="{{ MEDIA_URL }}logo_wireframe_by_aoife_ten_opt.png" alt="Logo for Kelly's Art & Photo Boutique">
        </a>

        <!-- Navbar Links - center, collapse on mobile - fixed with chatGPT's guidance -->
        <div class="collapse navbar-collapse justify-content-center" id="main-nav">
          <ul class="navbar-nav mx-auto">
            {% include 'includes/main-nav.html' %}
          </ul>
        </div>

        <!-- Header: Sign In, Sign Up, Cart, Search, Burger - all fixed with chatGPT's guidance -->
        <div class="d-flex align-items-center order-xl-3 ml-auto header_icons">

          <!-- User dropdown - fixed with Chat GPT's guidance -->
          <div class="nav-item mx-3 dropdown">
            {% if request.user.is_authenticated %}
              <!-- Signed in User dropdown - fixed with chatGPT's guidance -->
              <a class="nav-link dropdown-toggle font-weight-bold" href="#" id="signed-in-user-dropdown" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-label="Signed in User dropdown"
                 title="{{ request.user.username }}"">
                 <i class="fa-solid fa-user mr-2"></i>
                 <!-- Span - to limit long username from pushing Navbar down, and covering top of other pages - fixed with ChatGPT's guidance -->
                 <span class="username">{{ request.user.username }}</span>
              </a>

              <div class="dropdown-menu dropdown-menu-right border-0" aria-labelledby="signed-in-user-dropdown">
                {% if request.user.is_superuser %}
                  <a href="{% url 'add_product' %}" class="dropdown-item font-weight-bold"
                     aria-label="Product Management dropdown option for Site's Admin only">
                    Product Management
                  </a>
                {% endif %}
                <a href="{% url 'profile' %}" class="dropdown-item font-weight-bold" aria-label="My Profile dropdown option">
                  My Profile
                </a>
                <a href="{% url 'account_logout' %}" class="dropdown-item font-weight-bold" aria-label="Sign Out dropdown option">
                  Sign Out
                </a>
              </div>
            {% else %}
              <!-- Signed Out User Icon dropdown - fixed with ChatGPT's guidance -->
              <a class="nav-link dropdown-toggle font-weight-bold"
                  href="#"
                  id="signed-out-user-dropdown"
                  role="button"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                  aria-label="Signed Out User dropdown">
                <i class="fa-solid fa-user mr-2"></i>
              </a>
              <div class="dropdown-menu dropdown-menu-right border-0" aria-labelledby="signed-out-user-dropdown">
                <a href="{% url 'account_login' %}" class="dropdown-item">Sign In</a>
                <a href="{% url 'account_signup' %}" class="dropdown-item">Sign Up</a>
              </div>
            {% endif %}
          </div>

          <!-- Cart Icon - fixed with chatGPT's guidance -->
          <a class="nav-link position-relative mr-4" href="{% url 'view_cart' %}" aria-label="cart">
            <i class="fa-solid fa-cart-shopping"></i>
            {% if product_count %}
              <span class="badge badge-pill badge-info position-absolute" style="top: -3px; right: -7px;">
                {{ product_count }}
              </span>
            {% endif %}
          </a>
        
          <!-- Search Icon - for all screens (placed after 'Sign Up' for larger screens, below burger dropdown on smaller screens) -->
          <a class="nav-link mr-4" href="#" id="search_toggle" aria-label="Search">
            <i class="fa-solid fa-magnifying-glass"></i>
          </a>

          <!-- Search Form - hidden until Search Icon is clicked - fixed with chatGPT's guidance -->
          <div class="search_form">
            <form method="GET" action="{% url 'products' %}" class="d-flex">
              <input type="text"
                     name="q"
                     class="form-control form-control-sm border border-black rounded-0"
                     placeholder="Search our Boutique"
                     aria-label="Search">
              <button type="submit"
                      class="btn btn-blue border border-black rounded-0 ml-1"
                      aria-label="Submit Search">
                <i class="fa-solid fa-magnifying-glass"></i>
              </button>
            </form>
          </div>

          <!-- Burger Menu (medium and small screens only) - on the right - fixed with chatGPT's guidance -->
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-nav"
                  aria-controls="main-nav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>
      </nav>
    </header>

    <!-- Toast container (ensuring each toast is displayed only on relevant page) - fixed with ChatGPT's guidance -->
    <div class="message-container">
      {% if messages %}
        {% for message in messages %}
          {% with message.tags as tags %}

            {% if 'cart' in tags %}
              <!-- Cart Toast (item added or qty updated) - fixed with ChatGPT's guidance -->
              <div class="toast cart_toast custom-toast" role="alert">
                <div class="cart-message-wrapper p-2">
                  <div class="toast-body cart_toast_message">
                    <i class="fa-solid fa-check"></i> {{ message }}
                  </div>
                  <button type="button" class="btn-close cart_toast_close" data-dismiss="toast"  aria-label="Close"></button>
                </div>
              </div>

              {% elif 'login' in tags %}
                <!-- Sign In Toast - fixed with ChatGPT's guidance -->
                  <div class="toast signin_toast custom-toast" role="alert">
                    <div class="signin-message-wrapper p-3">
                      <div class="toast-body signin-message-wrapper p-2">
                        <div class="toast-body signin_toast_message">
                          {{ message }}
                        </div>
                      </div>
                    <button type="button" class="btn-close signin_toast_close" data-dismiss="toast"  aria-label="Close"></button>
                </div>
              </div>
            {% endif %}

          {% endwith %}
        {% endfor %}
      {% endif %}
    </div>

    {% block page_header %}
    {% endblock %}

    {% block content %}
    {% endblock %}

    {% block postloadjs %}
    <!-- JS fixed and delay added with ChatGPT's guidance -->
    <script type="text/javascript">
      document.addEventListener('DOMContentLoaded', function  () {
        var toastE1List = [].slice.call(document.querySelectorAll('.toast'));
        toastE1List.forEach(function (toastE1) {
          var toast = new bootstrap.Toast(toastE1, {
            delay: 4000,
            autohide: true
          });
          toast.show()
        });
      });
    </script>
    {% endblock %}

    <!-- Footer, base code from LoveRunning index.html-->
    <footer>
      <div class="footer">
        <div class="footer_text">
          Copyright &copy; 2025 | Barby Kelly | E-Commerce Project | Not for real transactions. 
          <div class="col-12">
          <a href="https://www.termsfeed.com/live/683c66f2-0b27-407d-970d-ea4c344d3557" target="_blank">Privacy Policy</a>
          </div>
        </div>

        <!-- Social Networks - noreferrer added with ChatGPT's guidance for security, Best Practices -->
        <ul id="social-networks">
          <li><a class="social-networks" href="https://www.facebook.com/" target="_blank" rel="noopener noreferrer"
          aria-label="Facebook home page (opens in a new tab)"><i class="fa-brands fa-square-facebook"></i></a>
          </li>
          <li><a class="social-networks" href="https://x.com/" target="_blank" rel="noopener noreferrer"
          aria-label="X/Twitter home page (opens in a new tab)"><i class="fa-brands fa-square-x-twitter"></i></a>
          </li>
          <li><a class="social-networks" href="https://www.youtube.com/" target="_blank" rel="noopener noreferrer"
          aria-label="YouTube home page (opens in a new tab)"><i class="fa-brands fa-youtube"></i></a>
          </li>
        </ul>
      </div>
    </footer>

    <!-- Lightbox2 JS - copied from ChatGPT to fix image click issue after csp was added -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.4/js/lightbox.min.js"></script>

    <!-- Script copied from ChatGPT, to help to show navbar items as active -->
    <script src="{% static 'js/active-nav.js' %}"></script>

    <!-- Script for Search Icon/form - all the parts learned from ChatGPT, to match with bootstrap4 -->
    <script>
    document.addEventListener("DOMContentLoaded", function () {
      const searchFormToggle = document.getElementById("search_toggle");
      const searchForm = document.querySelector(".search_form");
      const searchInput = searchForm.querySelector("input[name='q']");
      const burgerMenuToggler = document.querySelector(".navbar-toggler");
      const navBarCollapse = document.getElementById("main-nav");

      // Toggle Search Form
      searchFormToggle.addEventListener("click", function (e) {
        e.preventDefault();
        e.stopPropagation();

        // Close Burger Menu if open - fixed with chatGPT
        if ($(navBarCollapse).hasClass('show')) {
          $(navBarCollapse).collapse('hide');
        }

        const isActive = searchForm.classList.toggle("active");
        if (isActive) searchInput.focus();
      });

      // Close Search Form when clicking outside of it
      document.addEventListener("click", function (e) {
        if (searchForm.classList.contains("active") &&
            !searchForm.contains(e.target) &&
            e.target !== searchFormToggle) {
            searchForm.classList.remove("active");
        }
      });

      // Close Search Form on ESC key
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape" && searchForm.classList.contains("active")) {
          searchForm.classList.remove("active");
        }
      });

      // Close Search Form when Burger Menu is clicked - fixed with chatGPT's guidance
      burgerMenuToggler.addEventListener("click", function () {
        if (searchForm.classList.contains("active")) {
          searchForm.classList.remove("active");
        }
      });
    });
    </script>
  </body>
</html>